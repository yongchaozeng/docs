# 传输层

| 类型         | TCP                        | UDP                |
| ------------ | -------------------------- | ------------------ |
| 连接性       | 面向连接                   | 无连接             |
| 可靠性       | 可靠不丢包                 | 不可靠可能丢包     |
| 首部占用空间 | 大                         | 小                 |
| 传输速率     | 慢                         | 快                 |
| 资源消耗     | 大                         | 小                 |
| 应用场景     | 浏览器、文件传输、邮件发送 | 音视频、直播、实时 |
| 应用层协议   | HTTP、HTTPS、FTP、DNS      | DNS                |

### TCP 传输控制协议

首部至少 20 字节(20 固定字节加可选首部 40 字节可选)

##### 可靠传输

- 等待 ARQ

m1 请求完成之后 M2，M2 结束在 M3 协议自动重传请求 超时没收到消息 会重传 保证可靠请求 但是效率低

- 连续 ARQ + 滑动窗口协议

一口气发出 m1 m2 m3 m4 并且有顺序，接收到发出确认 m4
窗口大小有接收方缓存窗口决定，发送完成后，窗口下移

- SACK 选择性确认

传 12345 2 丢失了 会重传 2 3 4 5 使用 SACK 只会传 2

##### 流量控制

接收窗口是动态改变的。流量控制可以防止缓存区满了，发送方发资源而无法接受，浪费资源。流量控制就是控制窗口大小

##### 拥塞控制

MSS 每个包最大多少 接受窗口 rwnd 发送窗口 swnd 拥塞窗口 cwnd

- 慢开始

指数增大
MSS =100 rwnd=3000 一次性能 300 个包

但实际 cwnd 初始值比较小 ，随着接收方确认指数增加

- 拥塞避免
  加法增大
  先是慢开始，然后达到 ssthresh(慢开始阈值)后，加法增大。然后根据网络阻塞，发现网络拥塞后 乘法减少 ssthresh 减半 ，cwnd 回复初始值再慢开始。达到 ssthresh 后继续加法增大。

- 快重传
  收到失序的包后，会重复请求上一个包，避免了超时重传的等待
  快恢复。从阈值开始加法增大

##### 连接管理

三次握手 四次挥手

标志位
ACK ACK = 1 确认号才有用
SYN 当 SYN = 1 ACK = 0 建立连接
当 SYN = 1 ACK = 1 回复同意建立连接

FIN 释放连接

序号 Seq 传输数据第一个字节
确认号 ack 用来确认传输的数据
窗口
数据偏移 首都长度

### UDP 用户数据报协议

首部 8 字节（源端口 目标端口 长度 校验和）
数据
